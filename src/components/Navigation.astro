---
/**
 * Navigation.astro
 * Site header with nav links
 * 
 * Minimal, editorial style matching the site aesthetic
 */

interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

const navItems = [
  { label: 'Stories', href: '/stories' },
  { label: 'Journal', href: '/journal' },
  { label: 'About', href: '/about' },
];
---

<header class="site-header" data-header>
  <nav class="site-nav">
    <a href="/" class="site-nav__logo">
      <span class="site-nav__logo-text">maexmaya</span>
    </a>

    <ul class="site-nav__links">
      {navItems.map((item) => (
        <li>
          <a 
            href={item.href} 
            class:list={[
              'site-nav__link',
              { 'is-active': currentPath.startsWith(item.href) }
            ]}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>

    <a href="/newsletter" class="site-nav__cta">
      Subscribe
    </a>

    <button class="site-nav__toggle" aria-label="Toggle menu" data-menu-toggle>
      <span class="site-nav__toggle-bar"></span>
      <span class="site-nav__toggle-bar"></span>
    </button>
  </nav>

  <!-- Mobile menu -->
  <div class="mobile-menu" data-mobile-menu hidden>
    <ul class="mobile-menu__links">
      {navItems.map((item) => (
        <li>
          <a 
            href={item.href} 
            class:list={[
              'mobile-menu__link',
              { 'is-active': currentPath.startsWith(item.href) }
            ]}
          >
            {item.label}
          </a>
        </li>
      ))}
      <li>
        <a href="/newsletter" class="mobile-menu__link mobile-menu__link--cta">
          Subscribe
        </a>
      </li>
    </ul>
  </div>
</header>

<style>
  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background-color: transparent;
    transition: background-color var(--duration-normal) var(--ease-out-quart),
                backdrop-filter var(--duration-normal) var(--ease-out-quart);
  }

  .site-header.is-scrolled {
    background-color: rgba(250, 248, 245, 0.9);
    backdrop-filter: blur(10px);
  }

  .site-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-md) var(--space-lg);
    max-width: 1400px;
    margin: 0 auto;
  }

  .site-nav__logo {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 500;
    letter-spacing: -0.02em;
    color: var(--color-ink);
    transition: color var(--duration-fast) var(--ease-out-quart);
  }

  .site-nav__logo:hover {
    color: var(--color-accent);
  }

  .site-nav__links {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    list-style: none;
  }

  .site-nav__link {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-ink-soft);
    transition: color var(--duration-fast) var(--ease-out-quart);
    position: relative;
  }

  .site-nav__link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 1px;
    background-color: var(--color-accent);
    transition: width var(--duration-normal) var(--ease-out-expo);
  }

  .site-nav__link:hover,
  .site-nav__link.is-active {
    color: var(--color-ink);
  }

  .site-nav__link:hover::after,
  .site-nav__link.is-active::after {
    width: 100%;
  }

  .site-nav__cta {
    font-size: 0.8125rem;
    font-weight: 500;
    padding: 0.5em 1.25em;
    border: 1px solid var(--color-ink);
    border-radius: 2em;
    color: var(--color-ink);
    transition: all var(--duration-fast) var(--ease-out-quart);
  }

  .site-nav__cta:hover {
    background-color: var(--color-ink);
    color: var(--color-paper);
  }

  .site-nav__toggle {
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    width: 24px;
    height: 24px;
    padding: 0;
  }

  .site-nav__toggle-bar {
    display: block;
    width: 100%;
    height: 1.5px;
    background-color: var(--color-ink);
    transition: transform var(--duration-normal) var(--ease-out-expo);
  }

  .site-nav__toggle.is-open .site-nav__toggle-bar:first-child {
    transform: translateY(3.25px) rotate(45deg);
  }

  .site-nav__toggle.is-open .site-nav__toggle-bar:last-child {
    transform: translateY(-3.25px) rotate(-45deg);
  }

  /* Mobile menu */
  .mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--color-paper);
    padding: calc(60px + var(--space-xl)) var(--space-lg) var(--space-lg);
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--duration-normal) var(--ease-out-quart),
                visibility var(--duration-normal) var(--ease-out-quart);
  }

  .mobile-menu.is-open {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu__links {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .mobile-menu__link {
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 400;
    color: var(--color-ink);
    display: block;
    padding: var(--space-sm) 0;
    border-bottom: 1px solid var(--color-border);
    transition: color var(--duration-fast) var(--ease-out-quart);
  }

  .mobile-menu__link:hover,
  .mobile-menu__link.is-active {
    color: var(--color-accent);
  }

  .mobile-menu__link--cta {
    color: var(--color-accent);
    border-bottom: none;
    margin-top: var(--space-md);
  }

  @media (max-width: 768px) {
    .site-nav__links,
    .site-nav__cta {
      display: none;
    }

    .site-nav__toggle {
      display: flex;
    }
  }
</style>

<script>
  function initNavigation() {
    const header = document.querySelector('[data-header]');
    const menuToggle = document.querySelector('[data-menu-toggle]');
    const mobileMenu = document.querySelector('[data-mobile-menu]');

    if (!header || !menuToggle || !mobileMenu) return;

    // Scroll behavior
    let lastScroll = 0;
    
    function handleScroll() {
      const currentScroll = window.scrollY;
      
      if (currentScroll > 50) {
        header.classList.add('is-scrolled');
      } else {
        header.classList.remove('is-scrolled');
      }
      
      lastScroll = currentScroll;
    }

    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll(); // Check initial state

    // Mobile menu toggle
    menuToggle.addEventListener('click', () => {
      const isOpen = mobileMenu.classList.contains('is-open');
      
      if (isOpen) {
        mobileMenu.classList.remove('is-open');
        menuToggle.classList.remove('is-open');
        mobileMenu.setAttribute('hidden', '');
        document.body.style.overflow = '';
      } else {
        mobileMenu.classList.add('is-open');
        menuToggle.classList.add('is-open');
        mobileMenu.removeAttribute('hidden');
        document.body.style.overflow = 'hidden';
      }
    });

    // Close menu on link click
    mobileMenu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove('is-open');
        menuToggle.classList.remove('is-open');
        mobileMenu.setAttribute('hidden', '');
        document.body.style.overflow = '';
      });
    });
  }

  document.addEventListener('DOMContentLoaded', initNavigation);
  document.addEventListener('astro:page-load', initNavigation);
</script>
